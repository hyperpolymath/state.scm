= STATE Format Version Evolution Policy
:toc: left
:toclevels: 3
:sectnums:

== Overview

This document defines the versioning strategy, compatibility guarantees, and
evolution procedures for the STATE (Stateful Context Tracking Engine) format
specification.

== Version Numbering

=== Semantic Versioning

STATE format versions follow https://semver.org/[Semantic Versioning 2.0.0]:

----
MAJOR.MINOR.PATCH
----

[cols="1,3,3"]
|===
|Component |Meaning |Example

|MAJOR
|Breaking changes that require parser updates
|`1.0` → `2.0`

|MINOR
|New features, backward-compatible
|`2.0` → `2.1`

|PATCH
|Bug fixes, clarifications
|`2.0.0` → `2.0.1`
|===

=== Schema Version

The `schema-version` field uses ISO 8601 dates (`YYYY-MM-DD`) to track
individual schema revisions within a format version:

[source,scheme]
----
(metadata
  (format-version . "2.0")
  (schema-version . "2025-12-08"))
----

== Compatibility Guarantees

=== Forward Compatibility

Files created with an older version MUST be readable by newer parsers:

* Version 1.x files MUST be readable by 2.x parsers
* Unknown fields SHOULD be preserved on round-trip
* Missing optional fields MUST use default values

=== Backward Compatibility

Within a major version, files created with newer minor versions SHOULD be
readable by older parsers with graceful degradation:

* Unknown sections MAY be ignored with a warning
* Unknown fields within known sections MAY be ignored
* Required fields MUST NOT change within a major version

=== Breaking Changes

The following changes require a MAJOR version increment:

* Removing or renaming required sections
* Removing or renaming required fields
* Changing the type of an existing field
* Changing the semantics of existing fields
* Modifying the top-level structure

=== Non-Breaking Changes

The following changes require only a MINOR version increment:

* Adding new optional sections
* Adding new optional fields to existing sections
* Adding new values to enumerations
* Adding new serialization bindings

== Version Matrix

[cols="1,2,2,2"]
|===
|Format Version |Release Date |Status |Key Changes

|1.0
|2025-12-01
|Superseded
|Initial release

|2.0
|2025-12-08
|Current
|Added history, roadmap, issues, questions sections

|2.1
|Planned
|Draft
|JSON-LD context, IANA registration

|3.0
|Future
|Vision
|Multi-user support, CRDT merging
|===

== Migration Procedures

=== Upgrading Files

When upgrading a STATE file to a newer format version:

1. **Backup** the original file
2. **Parse** using the original version's parser
3. **Transform** data structures as needed
4. **Add** default values for new required fields
5. **Serialize** using the new version's writer
6. **Validate** against the new schema

=== Version Detection

Parsers MUST:

1. Read the `format-version` field first
2. Select the appropriate parser implementation
3. Report errors for unsupported versions
4. Provide clear upgrade guidance

=== Deprecation Policy

Before removing a feature:

1. **Deprecation Notice**: Feature marked deprecated in MINOR release
2. **Warning Period**: Minimum 6 months or 2 minor releases
3. **Removal**: Feature removed in next MAJOR release

== Implementation Requirements

=== Parser Requirements

[cols="1,3"]
|===
|Requirement |Description

|Version Check
|MUST check `format-version` before parsing

|Major Rejection
|MUST reject files with unsupported major version

|Minor Tolerance
|SHOULD accept files with higher minor version

|Unknown Fields
|SHOULD preserve unknown fields on round-trip

|Error Messages
|MUST provide clear version mismatch errors
|===

=== Writer Requirements

[cols="1,3"]
|===
|Requirement |Description

|Version Output
|MUST write `format-version` field

|Schema Date
|MUST write current `schema-version`

|Timestamp
|MUST update `last-updated` on write

|Required Fields
|MUST include all required fields

|Valid Values
|MUST write only valid enumeration values
|===

== Stability Tiers

=== Tier 1: Stable

Fields marked as **Stable** have strong compatibility guarantees:

* Will not be removed or renamed
* Semantics will not change
* Type will not change

Stable fields:

* `metadata.format-version`
* `metadata.schema-version`
* `metadata.created-at`
* `metadata.last-updated`
* `user.name`
* `session.conversation-id`
* `focus.current-project`
* `projects[].name`
* `projects[].status`
* `projects[].completion`

=== Tier 2: Provisional

Fields marked as **Provisional** may change in future minor versions:

* May be renamed with deprecation notice
* Semantics may be clarified
* Additional constraints may be added

=== Tier 3: Experimental

Fields marked as **Experimental** may change without notice:

* May be removed in any release
* Semantics may change
* Not recommended for production use

== Extension Mechanism

=== Vendor Extensions

Implementations MAY add vendor-specific sections using the `x-` prefix:

[source,scheme]
----
(x-vendor-name
  (custom-field . "value"))
----

Vendor extensions:

* MUST use `x-` prefix
* MUST NOT conflict with standard sections
* SHOULD be documented
* MAY be ignored by other implementations

=== Future Reserved Names

The following section names are reserved for future standardization:

* `collaboration` - Multi-user features
* `sync` - Real-time synchronization
* `plugins` - Extension system
* `ai-config` - AI-specific settings
* `analytics` - Usage tracking

== Governance

=== Change Process

1. **Proposal**: Submit change proposal via GitHub issue
2. **Discussion**: Community review period (minimum 2 weeks)
3. **RFC**: Formal specification update
4. **Implementation**: Reference implementation update
5. **Release**: Version increment and changelog entry

=== Decision Authority

[cols="1,3"]
|===
|Change Type |Authority

|Patch releases
|Maintainers

|Minor releases
|Maintainers with community review

|Major releases
|Community consensus required
|===

== Changelog

=== 2.0.0 (2025-12-08)

* Added `history` section for velocity tracking
* Added `issues` section for known problems
* Added `questions` section for pending decisions
* Added `roadmap` section for planning
* Added `files-created-this-session` and `files-modified-this-session`
* Added `context-notes` section

=== 1.0.0 (2025-12-01)

* Initial format specification
* Core sections: metadata, user, session, focus, projects, critical-next

== References

* https://semver.org/[Semantic Versioning 2.0.0]
* https://keepachangelog.com/[Keep a Changelog]
* https://www.rfc-editor.org/rfc/rfc2119[RFC 2119: Key words for requirement levels]
